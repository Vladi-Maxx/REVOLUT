# Техническа документация - Revolut Dashboard

## Архитектура на приложението

### Общ преглед
Приложението е изградено на принципа на компонентно-ориентирана архитектура, където всеки компонент има ясно дефинирана отговорност. Основните компоненти са:

1. **DashboardView** - главен контролер на приложението, който координира всички останали компоненти
2. **FilterManager** - отговаря за управлението на филтрите и филтрирането на данните
3. **ChartComponent** - визуализира данните в графичен формат
4. **MerchantsTableComponent** - показва таблица с търговци и техните транзакции
5. **TransactionsTableComponent** - показва детайлна таблица с всички транзакции
6. **SummaryComponent** - показва обобщена информация за транзакциите
7. **CsvImporter** - отговаря за импортирането на CSV файлове с транзакции

### Комуникация между компонентите
Компонентите комуникират помежду си чрез:
- **Директни извиквания на методи** - когато един компонент има директна референция към друг
- **Callback функции** - за асинхронна комуникация и известяване при промени
- **Споделени данни** - чрез предаване на данни между компонентите

## Основни класове и тяхната функционалност

### DashboardView
Главният контролер на приложението, който:
- Инициализира всички компоненти
- Координира комуникацията между компонентите
- Обработва потребителските събития
- Управлява жизнения цикъл на приложението

```javascript
// Пример за инициализация на компоненти в DashboardView
this.filterManager = new FilterManager({
    elements: { /* ... */ },
    supabaseService: supabaseService,
    dataUtils: DataUtils,
    notificationCallback: this.showNotification.bind(this),
    onFilterSuccess: (result) => {
        // Обновяване на UI компонентите при промяна на филтрите
        if (result && result.success) {
            // Обновяване на summary панелите, таблицата с търговци и графиката
            // ...
        }
    }
});
```

### FilterManager
Отговаря за управлението на филтрите и филтрирането на данните:
- Инициализира филтрите с начални стойности
- Прилага филтрите към данните
- Известява другите компоненти при промяна на филтрите
- Подготвя данните за визуализация

```javascript
// Пример за прилагане на филтри в FilterManager
async applyFilters(allTransactions) {
    try {
        // Извличане на стойностите на филтрите
        const filters = this.getFilters();
        
        // Филтриране на транзакциите
        let filteredTransactions = this.filterTransactionsLocally(this.allTransactions, filters);
        
        // Подготовка на данните за визуализация
        const merchantsData = this.dataUtils.groupTransactionsByMerchant(filteredTransactions);
        
        // Изчисляване на статистики
        const stats = this.dataUtils.calculateTransactionStats(filteredTransactions);
        
        // Създаване на обект с резултатите
        const result = {
            success: true,
            filteredTransactions,
            filters,
            merchantsData: /* ... */,
            stats: /* ... */
        };
        
        // Известяване на другите компоненти при промяна на филтрите
        if (this.onFilterSuccess && typeof this.onFilterSuccess === 'function') {
            this.onFilterSuccess(result);
        }
        
        // Връщане на резултатите
        return result;
    } catch (error) {
        // Обработка на грешки
    }
}
```

### ChartComponent
Визуализира данните в графичен формат:
- Инициализира графиката с Chart.js
- Обновява графиката при промяна на данните
- Предоставя интерактивност на графиката

### CsvImporter
Отговаря за импортирането на CSV файлове с транзакции:
- Парсва CSV файловете
- Нормализира данните
- Идентифицира уникални транзакции
- Добавя нови транзакции към съществуващите

## Потоци на данни

### Зареждане на данни
1. DashboardView извиква `loadData()`
2. Данните се зареждат от Supabase чрез `supabaseService.getAllTransactions()`
3. FilterManager инициализира филтрите с `populateFilters()`
4. Прилагат се филтрите с `applyFilters()`
5. Компонентите се обновяват с филтрираните данни

### Филтриране на данни
1. Потребителят променя филтър (напр. тип транзакция)
2. FilterManager прихваща събитието и извиква `applyFilters()`
3. Данните се филтрират локално
4. FilterManager известява DashboardView чрез `onFilterSuccess` callback
5. DashboardView обновява всички компоненти с новите данни

### Импортиране на CSV
1. Потребителят избира CSV файл
2. DashboardView делегира импортирането на CsvImporter
3. CsvImporter парсва файла и нормализира данните
4. Новите транзакции се добавят към съществуващите
5. Филтрите се прилагат отново и UI се обновява

## Среди на изпълнение

Приложението поддържа три среди на изпълнение:
- **Dev** - за разработка, с локални данни и мокирани API извиквания
- **Test** - за тестване, с тестови данни и ограничени API извиквания
- **Prod** - за продукция, с реални данни и пълен достъп до API

## Добри практики

При разработката на приложението се следват следните добри практики:
- **Модулност** - всеки компонент има ясно дефинирана отговорност
- **Чист код** - избягване на дублиране и излишна сложност
- **Ефективност** - оптимизиране на производителността и използването на ресурси
- **Поддръжка** - лесна поддръжка и разширяване на функционалността
- **Тестване** - тестване на всички основни функционалности

## Известни проблеми и ограничения

- Приложението разчита на Supabase за съхранение на данни, което може да доведе до проблеми при липса на интернет връзка
- При голям обем данни може да има забавяне при филтрирането и визуализацията
- Някои браузъри може да имат проблеми с CSV импорта поради ограничения в сигурността
