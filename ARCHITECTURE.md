# Архитектура на приложението Revolut Dashboard

## Обща архитектура

Приложението следва модулна архитектура с ясно разделение на отговорностите между компонентите. Ключови архитектурни принципи:

1. **Принцип за единична отговорност (SRP)** - всеки клас има ясно дефинирана отговорност
2. **Разделяне на слоеве** - ясно разделение между UI компоненти, бизнес логика и достъп до данни
3. **Dependency Injection** - компонентите получават своите зависимости чрез конструктора

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   Sources   │────▶│    Core     │────▶│     UI      │
└─────────────┘     └─────────────┘     └─────────────┘
 CSV, Supabase      Data processing     Components, Views
```

## Компонентна диаграма

Приложението е изградено от следните основни компоненти, които взаимодействат помежду си:

```
┌─────────────────────────────────────────────────────────────────────────┐
│                             DashboardView                               │
└───────────────────────────────────┬─────────────────────────────────────┘
                                    │
                                    │ инициализира и управлява
                                    ▼
┌─────────────┐  ┌───────────────┐  ┌───────────────┐  ┌──────────────────┐
│ CsvImporter │  │ FilterManager │  │SupabaseService│  │QuickFilterManager│
└──────┬──────┘  └───────┬───────┘  └───────┬───────┘  └────────┬─────────┘
       │                 │                  │                    │
       │                 │                  │                    │
       │                 │                  │                    │
       │                 │                  │                    │
┌──────▼──────┐  ┌───────▼───────┐  ┌───────▼───────┐  ┌────────▼─────────┐
│  DataUtils  │  │ChartComponent │  │MerchantsTable │  │ SummaryComponent │
└─────────────┘  └───────────────┘  └───────────────┘  └──────────────────┘
```

## Поток на данните

1. **Начално зареждане на данни**:
   - При инициализация `DashboardView` прави заявка към `SupabaseService` или зарежда данни от CSV файл чрез `CsvImporter`
   - Данните се съхраняват в `DashboardView` и се предават на `FilterManager`

2. **Филтриране на данни**:
   - `FilterManager` прилага избраните филтри върху данните
   - Филтрираните данни се групират по търговци
   - Резултатите се предават обратно към `DashboardView`

3. **Обновяване на UI**:
   - `DashboardView` делегира обновяването на UI компонентите:
     - `ChartComponent` визуализира топ търговците в графика
     - `MerchantsTableComponent` показва детайлна информация за търговците
     - `SummaryComponent` показва общи статистики

4. **Бързи филтри**:
   - `QuickFilterManager` управлява предварително дефинирани периоди за филтриране
   - При избор на бърз филтър, информацията се предава на `FilterManager`

## Отговорности на основните класове

### DashboardView
- Инициализира всички компоненти
- Координира комуникацията между компонентите
- Обновява UI при промяна на данните
- Управлява събития на потребителския интерфейс

### FilterManager
- Управлява филтрите за период, валута и др.
- Прилага филтрите върху данните
- Групира данни по търговци
- Подготвя данни за графики и таблици

### CsvImporter
- Обработва импортирани CSV файлове
- Анализира и трансформира CSV данни в структуриран формат
- Идентифицира и премахва дублирани транзакции
- Нормализира дати и стойности

### ChartComponent
- Визуализира данни чрез Chart.js
- Управлява конфигурацията на графиките
- Показва информация при hover над графика
- Обновява се при промяна на данните

### MerchantsTableComponent
- Показва списък с търговци и техните обобщени данни
- Сортира търговци по сума/брой транзакции
- Форматира суми и дати за по-добра четимост

### SummaryComponent
- Показва обобщени статистики (общ брой транзакции, обща сума)
- Форматира данните за визуализация

### SupabaseService
- Осъществява комуникация със Supabase
- Извлича транзакции от базата данни
- Кешира данни за по-бърз достъп

### DataUtils
- Предоставя помощни методи за обработка на данни
- Форматира суми, дати и др.
- Предоставя методи за изчисляване на статистики

## Събития и слушатели

Основната комуникация между компонентите се осъществява чрез:

1. **Директни извиквания на методи** - когато компонентите са тясно свързани
2. **Callback функции** - предадени при инициализацията на компонентите
3. **DOM събития** - за реакция на потребителски действия

Примери за ключови събития:
- Промяна на филтри → обновяване на графика и таблици
- Импортиране на CSV → обновяване на данните и UI компонентите
- Избор на бърз филтър → обновяване на филтрите и данните

## Разширяване на приложението

### Добавяне на нов филтър
1. Добавяне на UI елементи в HTML
2. Разширяване на `FilterManager` с нови методи и логика
3. Обновяване на `DashboardView` за обработка на новите филтри

### Добавяне на нов UI компонент
1. Създаване на нов клас в директория `/components`
2. Добавяне на конструктор и методи за инициализация и обновяване
3. Интегриране на компонента в `DashboardView`

### Добавяне на нов източник на данни
1. Създаване на нов сервизен клас в директория `/services`
2. Имплементиране на методи за извличане и обработка на данни
3. Интегриране на сервиса в `DashboardView`
